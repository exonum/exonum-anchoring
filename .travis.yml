language: rust

rust:
  - stable

cache: cargo
sudo: required
dist: trusty
group: deprecated-2017Q2

env:
  global:
  - ANCHORING_RELAY_HOST=http://127.0.0.1:18332
  - ANCHORING_USER=travis
  - ANCHORING_PASSWORD=travis
  - RUST_LOG=off
  - NIGHTLY_RUST=nightly-2017-06-13
  - CLIPPY_VERS=0.0.139
  - RUSTFMT_VERS=0.9.0

before_install:
- rustfmt -V | grep $RUSTFMT_VERS || cargo install rustfmt --vers $RUSTFMT_VERS --force
- rustup toolchain install $NIGHTLY_RUST
- cargo +$NIGHTLY_RUST clippy -V | grep $CLIPPY_VERS || cargo +$NIGHTLY_RUST install clippy --vers $CLIPPY_VERS --force
- sudo add-apt-repository -y ppa:chris-lea/libsodium
- sudo apt-add-repository -y ppa:bitcoin/bitcoin
- sudo apt-get -qq update

install:
- sudo apt-get -qq --yes install gcc g++ make libsodium-dev libleveldb-dev libssl-dev
- sudo apt-get -qq --yes install bitcoind

before_script:
- bitcoind -regtest -server -rpcuser=travis -rpcpassword=travis -daemon
- sleep 10
- bitcoin-cli -regtest -rpcuser=travis -rpcpassword=travis generate 200

script:
- cargo fmt -- --write-mode=diff
- cargo fmt -p exonum-btc-anchoring-sandbox -- --write-mode=diff
- cargo +$NIGHTLY_RUST clippy -- -D warnings
- cargo test --release
- cargo test --manifest-path sandbox_tests/Cargo.toml

after_script:
- bitcoin-cli -regtest -rpcuser=travis -rpcpassword=travis stop

notifications:
  slack:
    secure: gMe8VDuiyZ3OXzvKTcEzWPELEoYsYVDxDNodBKzA03wgOhOa3dU7lky+KenpPRqNXaGx5VcrqdTYM0xJaLgHM9PBEtJahhsuRYESv3xqe4yAa4VT4dkjyP6oBK0f1gH+c5ZHIfSnCjFWLtUGjk72XqDjBjDxvwWCkheZyU81m7Sl4huPLE2oE4OHKBxd0l7oaCGjlHPTD5JRV3VQBhWnBjONkY3DQ3eMLqnBvgaOxmOMkOangFzcYMTUH1f7Q63K8+Hhk7In/Rg9vwpvutaUCCtz/6CMf4KRWLIGF5to4PVlOKez43fCj1W03e5rPqx22/g6MxUI9FNlz2iUYkBifOIqqjZq1teHVmi7pSifCKciCyY02hwIZ+gDasAhBmhX7fJsXwOc1oMtiej/WDIKyMSQ0GUCFUE6zuqL1XlLOLhAPOSqUo4Jkcitzo47g4f08/jqJW6SXnWg5SqDeAgFaMp9mYWZ1OroW4Gtt3Dzd5tFz7j2PMDzGrBzrq64DShQcNuzHfjuWvV9W3Tx5alPX9Y0o+LhvQo6/kmiSvVreIJLP+CdFDNMkaW7vZXuWAs+dd2fkAl4w2DA4Pkvd2q63wJdEn7I4+emJBkvzHmn2tTi+yKcruqXg7J4F+9vsYuT3zHizYfe5oYyMbdBJcxcfn78W5sjxvf5C4i0j+v+3Go=
